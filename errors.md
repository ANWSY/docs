# Errors & Logging

- [介绍](#introduction)
- [配置](#configuration)
- [异常处理](#the-exception-handler)
	- [Report 方法](#report-method)
	- [Render 方法](#render-method)
- [HTTP 异常](#http-exceptions)
	- [自定义 HTTP 错误页面](#custom-http-error-pages)
- [日志](#logging)

<a name="introduction"></a>
## 介绍

当你开始一个新的 Laravel 项目时，错误和异常处理已经为你配置好了，除些之外，Laravel 还集成了[Monolog](https://github.com/Seldaek/monolog)日志工具库，提供各种强大的日志处理程序。

<a name="configuration"></a>
## 配置

#### 错误详情

你的应用程序通过浏览器显示的错误详情的量，是由 `config/app.php` 配置文件中的 `debug` 选项来控制的，默认情况下，这个配置项是遵循 `APP_DEBUG` 环境变量来设置的，这个变量存放在 `.env` 文件中。

对于本地开发，应该将 `APP_DEBUG` 环境变量设置为 `true`。在生产环境中，这个值应该总是为 `false`。

#### 日志模式

在框架之外，Laravel 支持 `single`, `daily`, `syslog` 和 `errorlog` 多种日志模式，例如，如果你希望使用按天的日志文件而不是单个文件，你只需要将 `config/app.php` 中的 `log` 配置为：

	'log' => 'daily'

#### 配置 Monolog 

如果你希望完全控制应用程序中 Monolog 的配置方式，你可以使用程序中 `configureMonologUsing` 方法，你应该在 `bootstrap/app.php` 文件中，返回 `$app` 变量之前，调用此方法：

	$app->configureMonologUsing(function($monolog) {
		$monolog->pushHandler(...);
	});

	return $app;

<a name="the-exception-handler"></a>
##  异常处理

所有异常都是由 `App\Exceptions\Handler` 类来处理的，这个类包含有两个方法：`report` 和 `render`，后面我们将详细查看这些方法。

<a name="report-method"></a>
### Report 方法

`report` 方法像[BugSnag](https://bugsnag.com)一样，用于记录或发送异常信息到外部的服务，默认情况下，`report` 仅将异常传入基本类中记录日志的地方，然而，你可以你喜欢的方式记录异常信息。

For example, if you need to report different types of exceptions in different ways, you may use the PHP `instanceof` comparison operator:

	/**
	 * Report or log an exception.
	 *
	 * This is a great spot to send exceptions to Sentry, Bugsnag, etc.
	 *
	 * @param  \Exception  $e
	 * @return void
	 */
	public function report(Exception $e)
	{
		if ($e instanceof CustomException) {
			//
		}

		return parent::report($e);
	}

#### Ignoring Exceptions By Type

The `$dontReport` property of the exception handler contains an array of exception types that will not be logged. By default, exceptions resulting from 404 errors are not written to your log files. You may add other exception types to this array as needed.

<a name="render-method"></a>
### The Render Method

The `render` method is responsible for converting a given exception into an HTTP response that should be sent back to the browser. By default, the exception is passed to the base class which generates a response for you. However, you are free to check the exception type or return your own custom response:

    /**
     * Render an exception into an HTTP response.
     *
     * @param  \Illuminate\Http\Request  $request
     * @param  \Exception  $e
     * @return \Illuminate\Http\Response
     */
    public function render($request, Exception $e)
    {
    	if ($e instanceof CustomException) {
    		return response()->view('errors.custom', [], 500);
    	}

        return parent::render($request, $e);
    }

<a name="http-exceptions"></a>
## HTTP Exceptions

Some exceptions describe HTTP error codes from the server. For example, this may be a "page not found" error (404), an "unauthorized error" (401) or even a developer generated 500 error. In order to generate such a response from anywhere in your application, use the following:

	abort(404);

The `abort` method will immediately raise an exception which will be rendered by the exception handler. Optionally, you may provide the response text:

	abort(403, 'Unauthorized action.');

This method may be used at any time during the request's lifecycle.

<a name="custom-http-error-pages"></a>
### Custom HTTP Error Pages

Laravel makes it easy to return custom error pages for various HTTP status codes. For example, if you wish to customize the error page for 404 HTTP status codes, create a `resources/views/errors/404.blade.php`. This file will be served on all 404 errors generated by your application.

The views within this directory should be named to match the HTTP status code they correspond to.

<a name="logging"></a>
## Logging

The Laravel logging facilities provide a simple layer on top of the powerful [Monolog](http://github.com/seldaek/monolog) library. By default, Laravel is configured to create daily log files for your application which are stored in the `storage/logs` directory. You may write information to the logs using the `Log` [facade](/docs/{{version}}/facades):

	<?php

	namespace App\Http\Controllers;

	use Log;
	use App\Http\Controllers\Controller;

	class UserController extends Controller
	{
		/**
		 * Show the profile for the given user.
		 *
		 * @param  int  $id
		 * @return Response
		 */
		public function showProfile($id)
		{
			Log::info('Showing user profile for user: '.$id);

			return view('user.profile', ['user' => User::findOrFail($id)]);
		}
	}

The logger provides the seven logging levels defined in [RFC 5424](http://tools.ietf.org/html/rfc5424): **debug**, **info**, **notice**, **warning**, **error**, **critical**, and **alert**.

	Log::debug($error);
	Log::info($error);
	Log::notice($error);
	Log::warning($error);
	Log::error($error);
	Log::critical($error);
	Log::alert($error);

#### Contextual Information

An array of contextual data may also be passed to the log methods. This contextual data will be formatted and displayed with the log message:

	Log::info('User failed to login.', ['id' => $user->id]);

#### Accessing The Underlying Monolog Instance

Monolog has a variety of additional handlers you may use for logging. If needed, you may access the underlying Monolog instance being used by Laravel:

	$monolog = Log::getMonolog();
